/********************************************************/
/*
 *
 *
 */
var aw_local_map_color_code = {
                        video: { color: "aw_grid_box_color_yellow", show: "VIDEOS" },
                        image: { color: "aw_grid_box_color_red", show: "PICS" },
                        location: { color: "aw_grid_box_color_mid_green", show: "PLACES" },
                        post: { color: "aw_grid_box_color_pink", show: "POSTS" },
                        mention: { color: "aw_grid_box_color_brown", show: "MENTIONS" },
                        link: { color: "aw_grid_box_color_light_magenta", show: "LINKS" }
                     };
var aw_local_map_box_classes = [
                                  "aw_sketch_dyn_topic_grid_box_top_left",
                                  "aw_sketch_dyn_topic_grid_box_top_right",
                                  "aw_sketch_dyn_topic_grid_box_bottom_left",
                                  "aw_sketch_dyn_topic_grid_box_bottom_right"
                                ];
/***********************************************************/
/*
 * Show in a priority list from 1 to 6 (top 4 non zero to be shown)
 *
 */
var aw_local_show_priority_list = {
                            video: 1,
                            image: 2,
                            link: 3,
                            location: 4,
                            mention: 5,
                            post: 6
                          };

function aw_get_values_to_show(topic_detail){
   var details_json = {};
   var push_to_complete = {};
   added_count = 0;
   $.each(aw_local_show_priority_list, function(key, priority) {
      if(topic_detail[key] != null
          && topic_detail[key] > 0 
            && added_count < 4){
        details_json[key] = topic_detail[key];
        added_count++;
      }else{
        push_to_complete[key] = 0;
      }
  });

  if( added_count < 4 ){
     $.each(push_to_complete, function(key, priority) {
        if( added_count < 4 ){
          details_json[key] = topic_detail[key];
          added_count++;
        }
     });
  }
  return details_json;
}

/*********************************************************/
/*
 *
 *
 */
function aw_get_service_distribution_html(topic_detail){
  //TODO: this is the dimension sensitive part based on css
  var remaining = 100;
  var min_share = 30;
  var total_services = topic_detail.services.length;
  var total_remaining = 100 - (total_services * min_share);
  var html = '<div class="aw_sketch_dyn_topic_service_distro" >';
  $.each( topic_detail.services, function( key, service_share){
    var service_class = "aw_sketch_dyn_topic_service_" + key;
    var share = total_remaining * service_share / 100;
    html = html + '< div class="' + service_class + '">' +
                    '< img src="/images/actwitty/refactor/aw_sketch/topic_share' + key + '.png"  height=18px >' +
                  '</div>';
  });

  html = html +  '</div>';
}

/*********************************************************/
/*
 *
 *
 */
function aw_api_view_interest_render(data){
  var html = "";
  var single_box_html = "";
  $.each(data, function(index, topic_detail) { 
    var internal_details_html = "";
    var position_count = 0;

    var to_show_json = aw_get_values_to_show(topic_detail);
    $.each( to_show_json, function( key, show_detail){

      var box_class = aw_local_map_box_classes[position_count];
      var box_color_class = aw_local_map_color_code[ key ].color;
      var box_click_handle_class = "aw_js_topic_click_" + key;
      var box_title = aw_local_map_color_code[ key ].show;
      
      internal_details_html = internal_details_html + 
                              '<div class="' + box_class + ' ' + box_color_class + ' ' + box_click_handle_class + '" >' +
                                  '<span class="aw_sketch_dyn_topic_grid_number">' + show_detail + '</span>' +
                                  '<span class="aw_sketch_dyn_topic_grid_number">' + box_title + '</span>' +
                              '</div>';
      
      position_count++;

         
    });
  
    var 
    single_box_html = '<div class="aw_sketch_dyn_topics_box aw_js_topic_back_tracker" >' +
                        '<input type="hidden" class="aw_js_topic_id" value="' + topic_detail.interest_id  + '" />' +
                        '<div class="aw_sketch_dyn_topic_title">' +
                          '<span>' + topic_detail.name + '</span>' +
                        '</div>' +
                         internal_details_html  +
                         '<img class="aw_sketch_dyn_topic_logo_small" src="/images/actwitty/refactor/aw_sketch/topics/' + topic_detail.category + '.png" width="40px" height="40px" />' +
                         '<img class="aw_sketch_dyn_topic_logo_large" src="/images/actwitty/refactor/aw_sketch/topics/' + topic_detail.category + '.png" width="60px" height="60px" />' +
                         aw_get_service_distribution_html(topic_detail);

                      '</div>';
    html = html + single_box_html;
  });

  $("#aw_js_topics_list_box").html(html);

}
